var Ys=Object.defineProperty;var Qs=(s,e,t)=>e in s?Ys(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var dn=(s,e,t)=>(Qs(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function U(){}function ws(s){return s()}function zn(){return Object.create(null)}function Le(s){s.forEach(ws)}function _s(s){return typeof s=="function"}function ve(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function er(s){return Object.keys(s).length===0}function I(s,e){s.appendChild(e)}function Ae(s,e,t){s.insertBefore(e,t||null)}function ge(s){s.parentNode&&s.parentNode.removeChild(s)}function T(s){return document.createElement(s)}function In(s){return document.createTextNode(s)}function J(){return In(" ")}function tr(){return In("")}function ut(s,e,t,n){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t,n)}function F(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function nr(s){return Array.from(s.childNodes)}function Jn(s,e){s.value=e??""}function ht(s,e,t,n){t==null?s.style.removeProperty(e):s.style.setProperty(e,t,"")}function dt(s,e,t){s.classList.toggle(e,!!t)}function sr(s,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:n})}let tt;function Ye(s){tt=s}function rr(){if(!tt)throw new Error("Function called outside component initialization");return tt}function ar(){const s=rr();return(e,t,{cancelable:n=!1}={})=>{const r=s.$$.callbacks[e];if(r){const a=sr(e,t,{cancelable:n});return r.slice().forEach(i=>{i.call(s,a)}),!a.defaultPrevented}return!0}}const Se=[],Gn=[];let Fe=[];const Kn=[],ir=Promise.resolve();let yn=!1;function or(){yn||(yn=!0,ir.then(ys))}function bn(s){Fe.push(s)}const fn=new Set;let Ce=0;function ys(){if(Ce!==0)return;const s=tt;do{try{for(;Ce<Se.length;){const e=Se[Ce];Ce++,Ye(e),lr(e.$$)}}catch(e){throw Se.length=0,Ce=0,e}for(Ye(null),Se.length=0,Ce=0;Gn.length;)Gn.pop()();for(let e=0;e<Fe.length;e+=1){const t=Fe[e];fn.has(t)||(fn.add(t),t())}Fe.length=0}while(Se.length);for(;Kn.length;)Kn.pop()();yn=!1,fn.clear(),Ye(s)}function lr(s){if(s.fragment!==null){s.update(),Le(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(bn)}}function cr(s){const e=[],t=[];Fe.forEach(n=>s.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Fe=e}const wt=new Set;let _e;function ur(){_e={r:0,c:[],p:_e}}function hr(){_e.r||Le(_e.c),_e=_e.p}function he(s,e){s&&s.i&&(wt.delete(s),s.i(e))}function pe(s,e,t,n){if(s&&s.o){if(wt.has(s))return;wt.add(s),_e.c.push(()=>{wt.delete(s),n&&(t&&s.d(1),n())}),s.o(e)}else n&&n()}function He(s){s&&s.c()}function $e(s,e,t){const{fragment:n,after_update:r}=s.$$;n&&n.m(e,t),bn(()=>{const a=s.$$.on_mount.map(ws).filter(_s);s.$$.on_destroy?s.$$.on_destroy.push(...a):Le(a),s.$$.on_mount=[]}),r.forEach(bn)}function ke(s,e){const t=s.$$;t.fragment!==null&&(cr(t.after_update),Le(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function dr(s,e){s.$$.dirty[0]===-1&&(Se.push(s),or(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function De(s,e,t,n,r,a,i=null,o=[-1]){const f=tt;Ye(s);const m=s.$$={fragment:null,ctx:[],props:a,update:U,not_equal:r,bound:zn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:zn(),dirty:o,skip_bound:!1,root:e.target||f.$$.root};i&&i(m.root);let b=!1;if(m.ctx=t?t(s,e.props||{},(A,x,...S)=>{const w=S.length?S[0]:x;return m.ctx&&r(m.ctx[A],m.ctx[A]=w)&&(!m.skip_bound&&m.bound[A]&&m.bound[A](w),b&&dr(s,A)),x}):[],m.update(),b=!0,Le(m.before_update),m.fragment=n?n(m.ctx):!1,e.target){if(e.hydrate){const A=nr(e.target);m.fragment&&m.fragment.l(A),A.forEach(ge)}else m.fragment&&m.fragment.c();e.intro&&he(s.$$.fragment),$e(s,e.target,e.anchor),ys()}Ye(f)}class je{constructor(){dn(this,"$$");dn(this,"$$set")}$destroy(){ke(this,1),this.$destroy=U}$on(e,t){if(!_s(t))return U;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!er(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const fr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(fr);const xe="4.47.1";let Zn=!1,Qe,bs,vs,vn,As,Cs,Ss,xs,Ps;function mr(s,e={auto:!1}){if(Zn)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(Qe)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${Qe}'\``);Zn=e.auto,Qe=s.kind,bs=s.fetch,vs=s.FormData,vn=s.File,As=s.ReadableStream,Cs=s.getMultipartRequestOptions,Ss=s.getDefaultAgent,xs=s.fileFromPath,Ps=s.isFsReadStream}class gr{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function pr({manuallyImported:s}={}){const e=s?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,r,a;try{t=fetch,n=Request,r=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:r,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new gr(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}Qe||mr(pr(),{auto:!0});class k extends Error{}class H extends k{constructor(e,t,n,r){super(`${H.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"];const a=t;this.error=a,this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e)return new an({cause:Cn(t)});const a=t==null?void 0:t.error;return e===400?new Es(e,a,n,r):e===401?new $s(e,a,n,r):e===403?new ks(e,a,n,r):e===404?new Rs(e,a,n,r):e===409?new Fs(e,a,n,r):e===422?new Is(e,a,n,r):e===429?new Ms(e,a,n,r):e>=500?new Os(e,a,n,r):new H(e,a,n,r)}}class V extends H{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class an extends H{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Mn extends an{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Es extends H{constructor(){super(...arguments),this.status=400}}class $s extends H{constructor(){super(...arguments),this.status=401}}class ks extends H{constructor(){super(...arguments),this.status=403}}class Rs extends H{constructor(){super(...arguments),this.status=404}}class Fs extends H{constructor(){super(...arguments),this.status=409}}class Is extends H{constructor(){super(...arguments),this.status=422}}class Ms extends H{constructor(){super(...arguments),this.status=429}}class Os extends H{}class ie{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of wr(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(f){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),f}if(o&&o.error)throw new H(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(f){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),f}if(i.event=="error")throw new H(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new ie(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const i=new be,o=Ts(e);for await(const f of o)for(const m of i.decode(f))yield m;for(const f of i.flush())yield f}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of r())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new ie(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new ie(()=>r(e),this.controller),new ie(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new As({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await t.next();if(i)return r.close();const o=n.encode(JSON.stringify(a)+`
`);r.enqueue(o)}catch(a){r.error(a)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*wr(s,e){if(!s.body)throw e.abort(),new k("Attempted to iterate over a response with no body");const t=new br,n=new be,r=Ts(s.body);for await(const a of _r(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*_r(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=yr(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function yr(s){for(let n=0;n<s.length-2;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}class br{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=vr(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}class be{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=be.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(be.NEWLINE_REGEXP);return n&&r.pop(),r.length===1&&!n?(this.buffer.push(r[0]),[]):(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new k(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new k(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new k("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}be.NEWLINE_CHARS=new Set([`
`,"\r"]);be.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function vr(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}function Ts(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Ls=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",Ds=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&js(s),js=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Ar=s=>Ds(s)||Ls(s)||Ps(s);async function Bs(s,e,t){var r;if(s=await s,t??(t=Ds(s)?{lastModified:s.lastModified,type:s.type}:{}),Ls(s)){const a=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new vn([a],e,t)}const n=await Cr(s);if(e||(e=xr(s)??"unknown_file"),!t.type){const a=(r=n[0])==null?void 0:r.type;typeof a=="string"&&(t={...t,type:a})}return new vn(n,e,t)}async function Cr(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(js(s))e.push(await s.arrayBuffer());else if(Pr(s))for await(const n of s)e.push(n);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${Sr(s)}`);return e}function Sr(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function xr(s){var e;return mn(s.name)||mn(s.filename)||((e=mn(s.path))==null?void 0:e.split(/[\\/]/).pop())}const mn=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},Pr=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Yn=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody",nt=async s=>{const e=await Er(s.body);return Cs(e,s)},Er=async s=>{const e=new vs;return await Promise.all(Object.entries(s||{}).map(([t,n])=>An(e,t,n))),e},An=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(Ar(t)){const n=await Bs(t);s.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>An(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>An(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ie={},$r=function(s,e,t,n,r){if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t},kr=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},ft;async function Ns(s){const{response:e}=s;if(s.options.stream)return Me("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):ie.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const a=await e.json();return Me("response",e.status,e.url,e.headers,a),a}const r=await e.text();return Me("response",e.status,e.url,e.headers,r),r}class on extends Promise{constructor(e,t=Ns){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new on(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Rr{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=gn("maxRetries",t),this.timeout=gn("timeout",n),this.httpAgent=r,this.fetch=a??bs}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Lr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Nr()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var w;const{method:t,path:n,query:r,headers:a={}}=e,i=Yn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(i),f=this.buildURL(n,r);"timeout"in e&&gn("timeout",e.timeout);const m=e.timeout??this.timeout,b=e.httpAgent??this.httpAgent??Ss(f),A=m+1e3;typeof((w=b==null?void 0:b.options)==null?void 0:w.timeout)=="number"&&A>(b.options.timeout??0)&&(b.options.timeout=A),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const x=this.buildHeaders({options:e,headers:a,contentLength:o});return{req:{method:t,...i&&{body:i},headers:x,...b&&{agent:b},signal:e.signal??null},url:f,timeout:m}}buildHeaders({options:e,headers:t,contentLength:n}){const r={};n&&(r["content-length"]=n);const a=this.defaultHeaders(e);return ns(r,a),ns(r,t),Yn(e.body)&&Qe!=="node"&&delete r["content-type"],this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return H.generate(e,t,n,r)}request(e,t=null){return new on(this.makeRequest(e,t))}async makeRequest(e,t){var b,A;const n=await e;t==null&&(t=n.maxRetries??this.maxRetries),await this.prepareOptions(n);const{req:r,url:a,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(r,{url:a,options:n}),Me("request",a,n,r.headers),(b=n.signal)!=null&&b.aborted)throw new V;const o=new AbortController,f=await this.fetchWithTimeout(a,r,i,o).catch(Cn);if(f instanceof Error){if((A=n.signal)!=null&&A.aborted)throw new V;if(t)return this.retryRequest(n,t);throw f.name==="AbortError"?new Mn:new an({cause:f})}const m=Ir(f.headers);if(!f.ok){if(t&&this.shouldRetry(f)){const C=`retrying, ${t} attempts remaining`;return Me(`response (error; ${C})`,f.status,a,m),this.retryRequest(n,t,m)}const x=await f.text().catch(C=>Cn(C).message),S=Dr(x),w=S?void 0:x;throw Me(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,f.status,a,m,w),this.makeStatusError(f.status,S,w,m)}return{response:f,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Fr(this,n,e)}buildURL(e,t){const n=Br(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Ws(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new k(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let r;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(r=o)}const i=n==null?void 0:n["retry-after"];if(i&&!r){const o=parseFloat(i);Number.isNaN(o)?r=Date.parse(i)-Date.now():r=o*1e3}if(!(r&&0<=r&&r<60*1e3)){const o=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,o)}return await at(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${xe}`}}class Hs{constructor(e,t,n,r){ft.set(this,void 0),$r(this,ft,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new k("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[r,a]of n)e.url.searchParams.set(r,a);t.query=void 0,t.path=e.url.toString()}return await kr(this,ft,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ft=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Fr extends on{constructor(e,t,n){super(t,async r=>new n(e,r.response,await Ns(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Ir=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Mr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},z=s=>typeof s=="object"&&s!==null&&!Ws(s)&&Object.keys(s).every(e=>Us(Mr,e)),Or=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xe,"X-Stainless-OS":es(Deno.build.os),"X-Stainless-Arch":Qn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xe,"X-Stainless-OS":es(process.platform),"X-Stainless-Arch":Qn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const s=Tr();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":xe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Tr(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const Qn=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",es=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let ts;const Lr=()=>ts??(ts=Or()),Dr=s=>{try{return JSON.parse(s)}catch{return}},jr=new RegExp("^(?:[a-z]+:)?//","i"),Br=s=>jr.test(s),at=s=>new Promise(e=>setTimeout(e,s)),gn=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new k(`${s} must be an integer`);if(e<0)throw new k(`${s} must be a positive integer`);return e},Cn=s=>s instanceof Error?s:new Error(s),mt=s=>{var e,t,n,r;if(typeof process<"u")return((e=Ie==null?void 0:Ie[s])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(r=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};function Ws(s){if(!s)return!0;for(const e in s)return!1;return!0}function Us(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function ns(s,e){for(const t in e){if(!Us(e,t))continue;const n=t.toLowerCase();if(!n)continue;const r=e[t];r===null?delete s[n]:r!==void 0&&(s[n]=r)}}function Me(s,...e){typeof process<"u"&&(Ie==null?void 0:Ie.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${s}`,...e)}const Nr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),Hr=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function ss(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}class On extends Hs{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ne extends Hs{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class M{constructor(e){this._client=e}}let Ft=class extends M{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};Ft||(Ft={});let It=class extends M{constructor(){super(...arguments),this.completions=new Ft(this._client)}};(function(s){s.Completions=Ft})(It||(It={}));class Mt extends M{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Mt||(Mt={});class Ot extends M{create(e,t){return this._client.post("/audio/transcriptions",nt({body:e,...t}))}}Ot||(Ot={});class Tt extends M{create(e,t){return this._client.post("/audio/translations",nt({body:e,...t}))}}Tt||(Tt={});class Lt extends M{constructor(){super(...arguments),this.transcriptions=new Ot(this._client),this.translations=new Tt(this._client),this.speech=new Mt(this._client)}}(function(s){s.Transcriptions=Ot,s.Translations=Tt,s.Speech=Mt})(Lt||(Lt={}));class Dt extends M{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return z(e)?this.list({},e):this._client.getAPIList("/batches",Tn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Tn extends ne{}(function(s){s.BatchesPage=Tn})(Dt||(Dt={}));class jt extends M{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return z(e)?this.list({},e):this._client.getAPIList("/assistants",Ln,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ln extends ne{}(function(s){s.AssistantsPage=Ln})(jt||(jt={}));function rs(s){return typeof s.parse=="function"}const Oe=s=>(s==null?void 0:s.role)==="assistant",qs=s=>(s==null?void 0:s.role)==="function",Xs=s=>(s==null?void 0:s.role)==="tool";var Z=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},E=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},W,_t,yt,We,Ue,bt,qe,ce,Xe,vt,At,Pe,Sn,Bt,xn,Pn,En,$n,Vs,kn;const as=10;class zs{constructor(){W.add(this),this.controller=new AbortController,_t.set(this,void 0),yt.set(this,()=>{}),We.set(this,()=>{}),Ue.set(this,void 0),bt.set(this,()=>{}),qe.set(this,()=>{}),ce.set(this,{}),this._chatCompletions=[],this.messages=[],Xe.set(this,!1),vt.set(this,!1),At.set(this,!1),Pe.set(this,!1),$n.set(this,e=>{if(Z(this,vt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new V),e instanceof V)return Z(this,At,!0,"f"),this._emit("abort",e);if(e instanceof k)return this._emit("error",e);if(e instanceof Error){const t=new k(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new k(String(e)))}),Z(this,_t,new Promise((e,t)=>{Z(this,yt,e,"f"),Z(this,We,t,"f")}),"f"),Z(this,Ue,new Promise((e,t)=>{Z(this,bt,e,"f"),Z(this,qe,t,"f")}),"f"),E(this,_t,"f").catch(()=>{}),E(this,Ue,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},E(this,$n,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(qs(e)||Xs(e))&&e.content)this._emit("functionCallResult",e.content);else if(Oe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Oe(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(E(this,yt,"f").call(this),this._emit("connect"))}get ended(){return E(this,Xe,"f")}get errored(){return E(this,vt,"f")}get aborted(){return E(this,At,"f")}abort(){this.controller.abort()}on(e,t){return(E(this,ce,"f")[e]||(E(this,ce,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=E(this,ce,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(E(this,ce,"f")[e]||(E(this,ce,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Z(this,Pe,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Z(this,Pe,!0,"f"),await E(this,Ue,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new k("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),E(this,W,"m",Sn).call(this)}async finalMessage(){return await this.done(),E(this,W,"m",Bt).call(this)}async finalFunctionCall(){return await this.done(),E(this,W,"m",xn).call(this)}async finalFunctionCallResult(){return await this.done(),E(this,W,"m",Pn).call(this)}async totalUsage(){return await this.done(),E(this,W,"m",En).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(E(this,Xe,"f"))return;e==="end"&&(Z(this,Xe,!0,"f"),E(this,bt,"f").call(this));const n=E(this,ce,"f")[e];if(n&&(E(this,ce,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!E(this,Pe,"f")&&!(n!=null&&n.length)&&Promise.reject(r),E(this,We,"f").call(this,r),E(this,qe,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!E(this,Pe,"f")&&!(n!=null&&n.length)&&Promise.reject(r),E(this,We,"f").call(this,r),E(this,qe,"f").call(this,r),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=E(this,W,"m",Bt).call(this);t&&this._emit("finalMessage",t);const n=E(this,W,"m",Sn).call(this);n&&this._emit("finalContent",n);const r=E(this,W,"m",xn).call(this);r&&this._emit("finalFunctionCall",r);const a=E(this,W,"m",Pn).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",E(this,W,"m",En).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),E(this,W,"m",Vs).call(this,t);const a=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(a)}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var x;const r="function",{function_call:a="auto",stream:i,...o}=t,f=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:m=as}=n||{},b={};for(const S of t.functions)b[S.name||S.function.name]=S;const A=t.functions.map(S=>({name:S.name||S.function.name,parameters:S.parameters,description:S.description}));for(const S of t.messages)this._addMessage(S,!1);for(let S=0;S<m;++S){const P=(x=(await this._createChatCompletion(e,{...o,function_call:a,functions:A,messages:[...this.messages]},n)).choices[0])==null?void 0:x.message;if(!P)throw new k("missing message in ChatCompletion response");if(!P.function_call)return;const{name:_,arguments:C}=P.function_call,l=b[_];if(l){if(f&&f!==_){const d=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:r,name:_,content:d});continue}}else{const d=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${A.map(p=>JSON.stringify(p.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:_,content:d});continue}let c;try{c=rs(l)?await l.parse(C):C}catch(d){this._addMessage({role:r,name:_,content:d instanceof Error?d.message:String(d)});continue}const u=await l.function(c,this),h=E(this,W,"m",kn).call(this,u);if(this._addMessage({role:r,name:_,content:h}),f)return}}async _runTools(e,t,n){var x,S;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,f=typeof a!="string"&&((x=a==null?void 0:a.function)==null?void 0:x.name),{maxChatCompletions:m=as}=n||{},b={};for(const w of t.tools)w.type==="function"&&(b[w.function.name||w.function.function.name]=w.function);const A="tools"in t?t.tools.map(w=>w.type==="function"?{type:"function",function:{name:w.function.name||w.function.function.name,parameters:w.function.parameters,description:w.function.description}}:w):void 0;for(const w of t.messages)this._addMessage(w,!1);for(let w=0;w<m;++w){const _=(S=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:A,messages:[...this.messages]},n)).choices[0])==null?void 0:S.message;if(!_)throw new k("missing message in ChatCompletion response");if(!_.tool_calls)return;for(const C of _.tool_calls){if(C.type!=="function")continue;const l=C.id,{name:c,arguments:u}=C.function,h=b[c];if(h){if(f&&f!==c){const g=`Invalid tool_call: ${JSON.stringify(c)}. ${JSON.stringify(f)} requested. Please try again`;this._addMessage({role:r,tool_call_id:l,content:g});continue}}else{const g=`Invalid tool_call: ${JSON.stringify(c)}. Available options are: ${A.map(R=>JSON.stringify(R.function.name)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:l,content:g});continue}let d;try{d=rs(h)?await h.parse(u):u}catch(g){const R=g instanceof Error?g.message:String(g);this._addMessage({role:r,tool_call_id:l,content:R});continue}const p=await h.function(d,this),v=E(this,W,"m",kn).call(this,p);if(this._addMessage({role:r,tool_call_id:l,content:v}),f)return}}}}_t=new WeakMap,yt=new WeakMap,We=new WeakMap,Ue=new WeakMap,bt=new WeakMap,qe=new WeakMap,ce=new WeakMap,Xe=new WeakMap,vt=new WeakMap,At=new WeakMap,Pe=new WeakMap,$n=new WeakMap,W=new WeakSet,Sn=function(){return E(this,W,"m",Bt).call(this).content??null},Bt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Oe(t))return{...t,content:t.content??null}}throw new k("stream ended without producing a ChatCompletionMessage with role=assistant")},xn=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Oe(r)&&(r!=null&&r.function_call))return r.function_call;if(Oe(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Pn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(qs(t)&&t.content!=null||Xs(t)&&t.content!=null&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},En=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Vs=function(e){if(e.n!=null&&e.n>1)throw new k("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},kn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class st extends zs{static runFunctions(e,t,n){const r=new st,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new st,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e){super._addMessage(e),Oe(e)&&e.content&&this._emit("content",e.content)}}var Y=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},pn=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},re,me,wn,_n,gt,is;class rt extends zs{constructor(){super(...arguments),re.add(this),me.set(this,void 0)}get currentChatCompletionSnapshot(){return Y(this,me,"f")}static fromReadableStream(e){const t=new rt;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new rt;return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Y(this,re,"m",wn).call(this);const a=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Y(this,re,"m",_n).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new V;return this._addChatCompletion(Y(this,re,"m",gt).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Y(this,re,"m",wn).call(this),this._connected();const r=ie.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(Y(this,re,"m",gt).call(this)),Y(this,re,"m",_n).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new V;return this._addChatCompletion(Y(this,re,"m",gt).call(this))}[(me=new WeakMap,re=new WeakSet,wn=function(){this.ended||pn(this,me,void 0,"f")},_n=function(t){var i,o,f;if(this.ended)return;const n=Y(this,re,"m",is).call(this,t);this._emit("chunk",t,n);const r=(o=(i=t.choices[0])==null?void 0:i.delta)==null?void 0:o.content,a=(f=n.choices[0])==null?void 0:f.message;r!=null&&(a==null?void 0:a.role)==="assistant"&&(a!=null&&a.content)&&this._emit("content",r,a.content)},gt=function(){if(this.ended)throw new k("stream has ended, this shouldn't happen");const t=Y(this,me,"f");if(!t)throw new k("request ended without sending any chunks");return pn(this,me,void 0,"f"),Wr(t)},is=function(t){var n,r,a;let i=Y(this,me,"f");const{choices:o,...f}=t;i?Object.assign(i,f):i=pn(this,me,{...f,choices:[]},"f");for(const{delta:m,finish_reason:b,index:A,logprobs:x=null,...S}of t.choices){let w=i.choices[A];if(w||(w=i.choices[A]={finish_reason:b,index:A,message:{},logprobs:x,...S}),x)if(!w.logprobs)w.logprobs=Object.assign({},x);else{const{content:u,...h}=x;Object.assign(w.logprobs,h),u&&((n=w.logprobs).content??(n.content=[]),w.logprobs.content.push(...u))}if(b&&(w.finish_reason=b),Object.assign(w,S),!m)continue;const{content:P,function_call:_,role:C,tool_calls:l,...c}=m;if(Object.assign(w.message,c),P&&(w.message.content=(w.message.content||"")+P),C&&(w.message.role=C),_&&(w.message.function_call?(_.name&&(w.message.function_call.name=_.name),_.arguments&&((r=w.message.function_call).arguments??(r.arguments=""),w.message.function_call.arguments+=_.arguments)):w.message.function_call=_),l){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:u,id:h,type:d,function:p,...v}of l){const g=(a=w.message.tool_calls)[u]??(a[u]={});Object.assign(g,v),h&&(g.id=h),d&&(g.type=d),p&&(g.function??(g.function={arguments:""})),p!=null&&p.name&&(g.function.name=p.name),p!=null&&p.arguments&&(g.function.arguments+=p.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ie(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Wr(s){const{id:e,choices:t,created:n,model:r,system_fingerprint:a,...i}=s;return{...i,id:e,choices:t.map(({message:o,finish_reason:f,index:m,logprobs:b,...A})=>{if(!f)throw new k(`missing finish_reason for choice ${m}`);const{content:x=null,function_call:S,tool_calls:w,...P}=o,_=o.role;if(!_)throw new k(`missing role for choice ${m}`);if(S){const{arguments:C,name:l}=S;if(C==null)throw new k(`missing function_call.arguments for choice ${m}`);if(!l)throw new k(`missing function_call.name for choice ${m}`);return{...A,message:{content:x,function_call:{arguments:C,name:l},role:_},finish_reason:f,index:m,logprobs:b}}return w?{...A,index:m,finish_reason:f,logprobs:b,message:{...P,role:_,content:x,tool_calls:w.map((C,l)=>{const{function:c,type:u,id:h,...d}=C,{arguments:p,name:v,...g}=c||{};if(h==null)throw new k(`missing choices[${m}].tool_calls[${l}].id
${pt(s)}`);if(u==null)throw new k(`missing choices[${m}].tool_calls[${l}].type
${pt(s)}`);if(v==null)throw new k(`missing choices[${m}].tool_calls[${l}].function.name
${pt(s)}`);if(p==null)throw new k(`missing choices[${m}].tool_calls[${l}].function.arguments
${pt(s)}`);return{...d,id:h,type:u,function:{...g,name:v,arguments:p}}})}}:{...A,message:{...P,content:x,role:_},finish_reason:f,index:m,logprobs:b}}),created:n,model:r,object:"chat.completion",...a?{system_fingerprint:a}:{}}}function pt(s){return JSON.stringify(s)}class Te extends rt{static fromReadableStream(e){const t=new Te;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const r=new Te,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new Te,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let Js=class extends M{runFunctions(e,t){return e.stream?Te.runFunctions(this._client.chat.completions,e,t):st.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Te.runTools(this._client.chat.completions,e,t):st.runTools(this._client.chat.completions,e,t)}stream(e,t){return rt.createChatCompletion(this._client.chat.completions,e,t)}};class Nt extends M{constructor(){super(...arguments),this.completions=new Js(this._client)}}(function(s){s.Completions=Js})(Nt||(Nt={}));var Q=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},L=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Ct,St,Ve,ze,xt,Je,ue,Ge,Pt,Et,Ee,Rn;class Ur{constructor(){this.controller=new AbortController,Ct.set(this,void 0),St.set(this,()=>{}),Ve.set(this,()=>{}),ze.set(this,void 0),xt.set(this,()=>{}),Je.set(this,()=>{}),ue.set(this,{}),Ge.set(this,!1),Pt.set(this,!1),Et.set(this,!1),Ee.set(this,!1),Rn.set(this,e=>{if(Q(this,Pt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new V),e instanceof V)return Q(this,Et,!0,"f"),this._emit("abort",e);if(e instanceof k)return this._emit("error",e);if(e instanceof Error){const t=new k(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new k(String(e)))}),Q(this,Ct,new Promise((e,t)=>{Q(this,St,e,"f"),Q(this,Ve,t,"f")}),"f"),Q(this,ze,new Promise((e,t)=>{Q(this,xt,e,"f"),Q(this,Je,t,"f")}),"f"),L(this,Ct,"f").catch(()=>{}),L(this,ze,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},L(this,Rn,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(L(this,St,"f").call(this),this._emit("connect"))}get ended(){return L(this,Ge,"f")}get errored(){return L(this,Pt,"f")}get aborted(){return L(this,Et,"f")}abort(){this.controller.abort()}on(e,t){return(L(this,ue,"f")[e]||(L(this,ue,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=L(this,ue,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(L(this,ue,"f")[e]||(L(this,ue,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Q(this,Ee,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Q(this,Ee,!0,"f"),await L(this,ze,"f")}_emit(e,...t){if(L(this,Ge,"f"))return;e==="end"&&(Q(this,Ge,!0,"f"),L(this,xt,"f").call(this));const n=L(this,ue,"f")[e];if(n&&(L(this,ue,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!L(this,Ee,"f")&&!(n!=null&&n.length)&&Promise.reject(r),L(this,Ve,"f").call(this,r),L(this,Je,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!L(this,Ee,"f")&&!(n!=null&&n.length)&&Promise.reject(r),L(this,Ve,"f").call(this,r),L(this,Je,"f").call(this,r),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,a){return await this._createToolAssistantStream(n,e,t,r,a)}async _createThreadAssistantStream(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(a)}async _createToolAssistantStream(e,t,n,r,a){const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,n,{...r,stream:!1},{...a,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,n,r){const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i=await e.create(t,{...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(i)}}Ct=new WeakMap,St=new WeakMap,Ve=new WeakMap,ze=new WeakMap,xt=new WeakMap,Je=new WeakMap,ue=new WeakMap,Ge=new WeakMap,Pt=new WeakMap,Et=new WeakMap,Ee=new WeakMap,Rn=new WeakMap;var y=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},q=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},N,Fn,ae,$t,ee,ye,Re,we,Ht,X,kt,Rt,et,Ke,Ze,os,ls,cs,us,hs,ds,fs;class te extends Ur{constructor(){super(...arguments),N.add(this),Fn.set(this,[]),ae.set(this,{}),$t.set(this,{}),ee.set(this,void 0),ye.set(this,void 0),Re.set(this,void 0),we.set(this,void 0),Ht.set(this,void 0),X.set(this,void 0),kt.set(this,void 0),Rt.set(this,void 0),et.set(this,void 0)}[(Fn=new WeakMap,ae=new WeakMap,$t=new WeakMap,ee=new WeakMap,ye=new WeakMap,Re=new WeakMap,we=new WeakMap,Ht=new WeakMap,X=new WeakMap,kt=new WeakMap,Rt=new WeakMap,et=new WeakMap,N=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new te;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=ie.fromReadableStream(e,this.controller);for await(const i of r)y(this,N,"m",Ke).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new V;return this._addRun(y(this,N,"m",Ze).call(this))}toReadableStream(){return new ie(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,a){const i=new te;return i._run(()=>i._runToolAssistantStream(e,t,n,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,r,a){var m;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},f=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const b of f)y(this,N,"m",Ke).call(this,b);if((m=f.controller.signal)!=null&&m.aborted)throw new V;return this._addRun(y(this,N,"m",Ze).call(this))}static createThreadAssistantStream(e,t,n){const r=new te;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new te;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return y(this,kt,"f")}currentRun(){return y(this,Rt,"f")}currentMessageSnapshot(){return y(this,ee,"f")}currentRunStepSnapshot(){return y(this,et,"f")}async finalRunSteps(){return await this.done(),Object.values(y(this,ae,"f"))}async finalMessages(){return await this.done(),Object.values(y(this,$t,"f"))}async finalRun(){if(await this.done(),!y(this,ye,"f"))throw Error("Final run was not received.");return y(this,ye,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const f of i)y(this,N,"m",Ke).call(this,f);if((o=i.controller.signal)!=null&&o.aborted)throw new V;return this._addRun(y(this,N,"m",Ze).call(this))}async _createAssistantStream(e,t,n,r){var f;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const m of o)y(this,N,"m",Ke).call(this,m);if((f=o.controller.signal)!=null&&f.aborted)throw new V;return this._addRun(y(this,N,"m",Ze).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(ss(a)&&ss(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}}Ke=function(e){if(!this.ended)switch(q(this,kt,e,"f"),y(this,N,"m",cs).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":y(this,N,"m",fs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":y(this,N,"m",ls).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":y(this,N,"m",os).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ze=function(){if(this.ended)throw new k("stream has ended, this shouldn't happen");if(!y(this,ye,"f"))throw Error("Final run has not been received");return y(this,ye,"f")},os=function(e){const[t,n]=y(this,N,"m",hs).call(this,e,y(this,ee,"f"));q(this,ee,t,"f"),y(this,$t,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=y(this,Re,"f")){if(y(this,we,"f"))switch(y(this,we,"f").type){case"text":this._emit("textDone",y(this,we,"f").text,y(this,ee,"f"));break;case"image_file":this._emit("imageFileDone",y(this,we,"f").image_file,y(this,ee,"f"));break}q(this,Re,r.index,"f")}q(this,we,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(y(this,Re,"f")!==void 0){const r=e.data.content[y(this,Re,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,y(this,ee,"f"));break;case"text":this._emit("textDone",r.text,y(this,ee,"f"));break}}y(this,ee,"f")&&this._emit("messageDone",e.data),q(this,ee,void 0,"f")}},ls=function(e){const t=y(this,N,"m",us).call(this,e);switch(q(this,et,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==y(this,Ht,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(y(this,X,"f")&&this._emit("toolCallDone",y(this,X,"f")),q(this,Ht,a.index,"f"),q(this,X,t.step_details.tool_calls[a.index],"f"),y(this,X,"f")&&this._emit("toolCallCreated",y(this,X,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":q(this,et,void 0,"f"),e.data.step_details.type=="tool_calls"&&y(this,X,"f")&&(this._emit("toolCallDone",y(this,X,"f")),q(this,X,void 0,"f")),this._emit("runStepDone",e.data,t);break}},cs=function(e){y(this,Fn,"f").push(e),this._emit("event",e)},us=function(e){switch(e.event){case"thread.run.step.created":return y(this,ae,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=y(this,ae,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=te.accumulateDelta(t,n.delta);y(this,ae,"f")[e.data.id]=r}return y(this,ae,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":y(this,ae,"f")[e.data.id]=e.data;break}if(y(this,ae,"f")[e.data.id])return y(this,ae,"f")[e.data.id];throw new Error("No snapshot available")},hs=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=y(this,N,"m",ds).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ds=function(e,t){return te.accumulateDelta(t,e)},fs=function(e){switch(q(this,Rt,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":q(this,ye,e.data,"f"),y(this,X,"f")&&(this._emit("toolCallDone",y(this,X,"f")),q(this,X,void 0,"f"));break}};class Wt extends M{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return z(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Dn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Dn extends ne{}(function(s){s.MessagesPage=Dn})(Wt||(Wt={}));class Ut extends M{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t,n={},r){return z(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,jn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class jn extends ne{}(function(s){s.RunStepsPage=jn})(Ut||(Ut={}));class qt extends M{constructor(){super(...arguments),this.steps=new Ut(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return z(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Bn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return te.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const f=i.headers.get("openai-poll-after-ms");if(f){const m=parseInt(f);isNaN(m)||(o=m)}}await at(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return te.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const a=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,a.id,r)}submitToolOutputsStream(e,t,n,r){return te.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class Bn extends ne{}(function(s){s.RunsPage=Bn,s.Steps=Ut,s.RunStepsPage=jn})(qt||(qt={}));class Xt extends M{constructor(){super(...arguments),this.runs=new qt(this._client),this.messages=new Wt(this._client)}create(e={},t){return z(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return te.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(s){s.Runs=qt,s.RunsPage=Bn,s.Messages=Wt,s.MessagesPage=Dn})(Xt||(Xt={}));const qr=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};let Vt=class extends M{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return z(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ln,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:r}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const f=a.response.headers.get("openai-poll-after-ms");if(f){const m=parseInt(f);isNaN(m)||(o=m)}}await at(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}};class ln extends ne{}(function(s){s.VectorStoreFilesPage=ln})(Vt||(Vt={}));class zt extends M{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return z(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ln,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const f=i.headers.get("openai-poll-after-ms");if(f){const m=parseInt(f);isNaN(m)||(o=m)}}await at(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t===null||t.length==0)throw new Error("No files provided to process.");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,f=t.values(),m=[...n];async function b(x){for(let S of x){const w=await o.files.create({file:S,purpose:"assistants"},r);m.push(w.id)}}const A=Array(i).fill(f).map(b);return await qr(A),await this.createAndPoll(e,{file_ids:m})}}zt||(zt={});class Jt extends M{constructor(){super(...arguments),this.files=new Vt(this._client),this.fileBatches=new zt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return z(e)?this.list({},e):this._client.getAPIList("/vector_stores",Nn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Nn extends ne{}(function(s){s.VectorStoresPage=Nn,s.Files=Vt,s.VectorStoreFilesPage=ln,s.FileBatches=zt})(Jt||(Jt={}));class Gt extends M{constructor(){super(...arguments),this.vectorStores=new Jt(this._client),this.chat=new Nt(this._client),this.assistants=new jt(this._client),this.threads=new Xt(this._client)}}(function(s){s.VectorStores=Jt,s.VectorStoresPage=Nn,s.Chat=Nt,s.Assistants=jt,s.AssistantsPage=Ln,s.Threads=Xt})(Gt||(Gt={}));class Kt extends M{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Kt||(Kt={});class Zt extends M{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}Zt||(Zt={});class Yt extends M{create(e,t){return this._client.post("/files",nt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return z(e)?this.list({},e):this._client.getAPIList("/files",Hn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await at(t),i=await this.retrieve(e),Date.now()-a>n)throw new Mn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}}class Hn extends On{}(function(s){s.FileObjectsPage=Hn})(Yt||(Yt={}));class Qt extends M{list(e,t={},n){return z(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Wn,{query:t,...n})}}class Wn extends ne{}(function(s){s.FineTuningJobCheckpointsPage=Wn})(Qt||(Qt={}));class en extends M{constructor(){super(...arguments),this.checkpoints=new Qt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return z(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Un,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return z(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,qn,{query:t,...n})}}class Un extends ne{}class qn extends ne{}(function(s){s.FineTuningJobsPage=Un,s.FineTuningJobEventsPage=qn,s.Checkpoints=Qt,s.FineTuningJobCheckpointsPage=Wn})(en||(en={}));class tn extends M{constructor(){super(...arguments),this.jobs=new en(this._client)}}(function(s){s.Jobs=en,s.FineTuningJobsPage=Un,s.FineTuningJobEventsPage=qn})(tn||(tn={}));class nn extends M{createVariation(e,t){return this._client.post("/images/variations",nt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",nt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}nn||(nn={});class sn extends M{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Xn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Xn extends On{}(function(s){s.ModelsPage=Xn})(sn||(sn={}));class rn extends M{create(e,t){return this._client.post("/moderations",{body:e,...t})}}rn||(rn={});var Gs;class j extends Rr{constructor({baseURL:e=mt("OPENAI_BASE_URL"),apiKey:t=mt("OPENAI_API_KEY"),organization:n=mt("OPENAI_ORG_ID")??null,project:r=mt("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new k("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Hr())throw new k(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Kt(this),this.chat=new It(this),this.embeddings=new Zt(this),this.files=new Yt(this),this.images=new nn(this),this.audio=new Lt(this),this.moderations=new rn(this),this.models=new sn(this),this.fineTuning=new tn(this),this.beta=new Gt(this),this.batches=new Dt(this),this._options=i,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}Gs=j;j.OpenAI=Gs;j.OpenAIError=k;j.APIError=H;j.APIConnectionError=an;j.APIConnectionTimeoutError=Mn;j.APIUserAbortError=V;j.NotFoundError=Rs;j.ConflictError=Fs;j.RateLimitError=Ms;j.BadRequestError=Es;j.AuthenticationError=$s;j.InternalServerError=Os;j.PermissionDeniedError=ks;j.UnprocessableEntityError=Is;j.toFile=Bs;j.fileFromPath=xs;(function(s){s.Page=On,s.CursorPage=ne,s.Completions=Kt,s.Chat=It,s.Embeddings=Zt,s.Files=Yt,s.FileObjectsPage=Hn,s.Images=nn,s.Audio=Lt,s.Moderations=rn,s.Models=sn,s.ModelsPage=Xn,s.FineTuning=tn,s.Beta=Gt,s.Batches=Dt,s.BatchesPage=Tn})(j||(j={}));function Xr(s){let e;return{c(){e=T("div"),e.innerHTML='<a href="//dzen.ru/" target="_blank"><svg width="286" height="83" viewBox="0 0 573 167" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_56_1208)"><path d="M490.51 127.13H509.12V89.9198H553.83V127.13H572.44V39.0898H553.83V74.6398H509.12V39.0898H490.51V127.13Z" fill="white"></path><path d="M478.02 87.4198C478.02 55.8998 461.91 35.7598 435.94 35.7598C409.97 35.7598 390.81 57.6998 390.81 83.1098C390.81 108.52 408.86 130.46 437.75 130.46C451.78 130.46 463.44 126.02 474.13 117.55L465.8 105.75C458.02 111.17 448.86 115.19 438.86 115.19C423.59 115.19 412.34 105.61 409.42 90.6098H478.02V87.4198ZM409.42 76.1698C412.06 61.5898 422.89 51.0398 435.94 51.0398C448.99 51.0398 457.74 60.8998 459.82 76.1698H409.41H409.42Z" fill="white"></path><path d="M343.87 130.47C368.17 130.47 382.61 118.94 382.61 103.39C382.61 93.8098 377.19 85.3398 363.86 82.5598L363.03 82.4198V81.5898L363.86 81.4498C376.5 78.9498 381.77 70.4798 381.77 61.4498C381.77 47.8398 369.41 35.7598 346.5 35.7598C331.09 35.7598 316.09 41.5898 303.45 50.4798L310.95 63.1198C319.7 57.1498 333.17 51.0398 345.25 51.0398C357.33 51.0398 363.86 57.1498 363.86 63.8198C363.86 70.0698 358.44 74.9298 345.39 75.6198L324.28 76.5898V88.6698L345.39 89.6398C359 90.3298 363.86 95.6098 363.86 101.44C363.86 108.11 357.33 115.05 342.48 115.05C328.87 115.05 317.21 109.22 307.49 102.69V120.19C313.04 124.08 326.1 130.47 343.87 130.47Z" fill="white"></path><path d="M288.05 108.25V39.0898H219.87L214.73 85.4698C212.79 104.08 206.95 108.24 196.96 108.24H196.13V145.73H214.74V127.12H280.7V145.73H299.31V108.24H288.06L288.05 108.25ZM269.44 111.86H219.73V111.03C225.7 108.81 230.84 105.06 232.37 90.4798L236.26 54.3798H269.45V111.87L269.44 111.86Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M83.45 166.23H82.79C49.78 166.23 30.48 162.91 17.04 149.73C3.19 135.62 0 116.45 0 83.58V82.65C0 49.78 3.19 30.48 17.04 16.5C30.61 3.33 49.78 0 82.78 0H83.45C116.32 0 135.62 3.33 149.2 16.5C163.05 30.61 166.24 49.78 166.24 82.65V83.58C166.24 116.46 163.04 135.76 149.2 149.73C135.62 162.9 116.46 166.23 83.45 166.23ZM145.97 80.6501C146.61 80.6801 147.13 81.2101 147.13 81.8501H147.12V84.5301C147.12 85.1801 146.6 85.7101 145.96 85.7301C122.99 86.6001 109.02 89.5201 99.2298 99.3101C89.4498 109.09 86.5298 123.04 85.6498 145.97C85.6198 146.61 85.0898 147.13 84.4498 147.13H81.7598C81.1098 147.13 80.5798 146.61 80.5598 145.97C79.6798 123.04 76.7598 109.09 66.9798 99.3101C57.1998 89.5301 43.2198 86.6001 20.2498 85.7301C19.6098 85.7001 19.0898 85.1701 19.0898 84.5301V81.8501C19.0898 81.2001 19.6098 80.6701 20.2498 80.6501C43.2198 79.7801 57.1898 76.8601 66.9798 67.0701C76.7798 57.2701 79.6998 43.2701 80.5698 20.2601C80.5998 19.6201 81.1298 19.1001 81.7698 19.1001H84.4498C85.0998 19.1001 85.6298 19.6201 85.6498 20.2601C86.5198 43.2801 89.4398 57.2701 99.2398 67.0701C109.02 76.8501 123 79.7801 145.97 80.6501Z" fill="white"></path></g><defs><clipPath id="clip0_56_1208"><rect width="572.44" height="166.23" fill="white"></rect></clipPath></defs></svg></a>',F(e,"class","logo svelte-lwb9qh")},m(t,n){Ae(t,e,n)},p:U,i:U,o:U,d(t){t&&ge(e)}}}class Vr extends je{constructor(e){super(),De(this,e,null,Xr,ve,{})}}function zr(s){let e,t,n,r,a,i,o,f,m;return{c(){e=T("div"),t=T("textarea"),n=J(),r=T("div"),a=T("button"),a.textContent="Сгенерировать",i=J(),o=T("button"),o.textContent="Обновить картинку",F(t,"class","pane editable"),F(t,"placeholder","Сгенерируй квадрат, расположенный ..."),F(o,"class","update-button svelte-1wurr2f"),F(r,"class","buttons svelte-1wurr2f")},m(b,A){Ae(b,e,A),I(e,t),Jn(t,s[0]),I(e,n),I(e,r),I(r,a),I(r,i),I(r,o),f||(m=[ut(t,"submit",s[1]),ut(t,"input",s[2]),ut(a,"click",s[1]),ut(o,"click",s[3])],f=!0)},p(b,[A]){A&1&&Jn(t,b[0])},i:U,o:U,d(b){b&&ge(e),f=!1,Le(m)}}}function Jr(s,e,t){let n="";const r=ar();function a(){r("submit",{prompt:n})}function i(){n=this.value,t(0,n)}return[n,a,i,()=>location.reload()]}class Gr extends je{constructor(e){super(),De(this,e,Jr,zr,ve,{})}}var ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kr={exports:{}};(function(s){var e=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var t=function(n){var r=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,i={},o={manual:n.Prism&&n.Prism.manual,disableWorkerMessageHandler:n.Prism&&n.Prism.disableWorkerMessageHandler,util:{encode:function l(c){return c instanceof f?new f(c.type,l(c.content),c.alias):Array.isArray(c)?c.map(l):c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(l){return Object.prototype.toString.call(l).slice(8,-1)},objId:function(l){return l.__id||Object.defineProperty(l,"__id",{value:++a}),l.__id},clone:function l(c,u){u=u||{};var h,d;switch(o.util.type(c)){case"Object":if(d=o.util.objId(c),u[d])return u[d];h={},u[d]=h;for(var p in c)c.hasOwnProperty(p)&&(h[p]=l(c[p],u));return h;case"Array":return d=o.util.objId(c),u[d]?u[d]:(h=[],u[d]=h,c.forEach(function(v,g){h[g]=l(v,u)}),h);default:return c}},getLanguage:function(l){for(;l;){var c=r.exec(l.className);if(c)return c[1].toLowerCase();l=l.parentElement}return"none"},setLanguage:function(l,c){l.className=l.className.replace(RegExp(r,"gi"),""),l.classList.add("language-"+c)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(h){var l=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(h.stack)||[])[1];if(l){var c=document.getElementsByTagName("script");for(var u in c)if(c[u].src==l)return c[u]}return null}},isActive:function(l,c,u){for(var h="no-"+c;l;){var d=l.classList;if(d.contains(c))return!0;if(d.contains(h))return!1;l=l.parentElement}return!!u}},languages:{plain:i,plaintext:i,text:i,txt:i,extend:function(l,c){var u=o.util.clone(o.languages[l]);for(var h in c)u[h]=c[h];return u},insertBefore:function(l,c,u,h){h=h||o.languages;var d=h[l],p={};for(var v in d)if(d.hasOwnProperty(v)){if(v==c)for(var g in u)u.hasOwnProperty(g)&&(p[g]=u[g]);u.hasOwnProperty(v)||(p[v]=d[v])}var R=h[l];return h[l]=p,o.languages.DFS(o.languages,function(O,G){G===R&&O!=l&&(this[O]=p)}),p},DFS:function l(c,u,h,d){d=d||{};var p=o.util.objId;for(var v in c)if(c.hasOwnProperty(v)){u.call(c,v,c[v],h||v);var g=c[v],R=o.util.type(g);R==="Object"&&!d[p(g)]?(d[p(g)]=!0,l(g,u,null,d)):R==="Array"&&!d[p(g)]&&(d[p(g)]=!0,l(g,u,v,d))}}},plugins:{},highlightAll:function(l,c){o.highlightAllUnder(document,l,c)},highlightAllUnder:function(l,c,u){var h={callback:u,container:l,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};o.hooks.run("before-highlightall",h),h.elements=Array.prototype.slice.apply(h.container.querySelectorAll(h.selector)),o.hooks.run("before-all-elements-highlight",h);for(var d=0,p;p=h.elements[d++];)o.highlightElement(p,c===!0,h.callback)},highlightElement:function(l,c,u){var h=o.util.getLanguage(l),d=o.languages[h];o.util.setLanguage(l,h);var p=l.parentElement;p&&p.nodeName.toLowerCase()==="pre"&&o.util.setLanguage(p,h);var v=l.textContent,g={element:l,language:h,grammar:d,code:v};function R(G){g.highlightedCode=G,o.hooks.run("before-insert",g),g.element.innerHTML=g.highlightedCode,o.hooks.run("after-highlight",g),o.hooks.run("complete",g),u&&u.call(g.element)}if(o.hooks.run("before-sanity-check",g),p=g.element.parentElement,p&&p.nodeName.toLowerCase()==="pre"&&!p.hasAttribute("tabindex")&&p.setAttribute("tabindex","0"),!g.code){o.hooks.run("complete",g),u&&u.call(g.element);return}if(o.hooks.run("before-highlight",g),!g.grammar){R(o.util.encode(g.code));return}if(c&&n.Worker){var O=new Worker(o.filename);O.onmessage=function(G){R(G.data)},O.postMessage(JSON.stringify({language:g.language,code:g.code,immediateClose:!0}))}else R(o.highlight(g.code,g.grammar,g.language))},highlight:function(l,c,u){var h={code:l,grammar:c,language:u};if(o.hooks.run("before-tokenize",h),!h.grammar)throw new Error('The language "'+h.language+'" has no grammar.');return h.tokens=o.tokenize(h.code,h.grammar),o.hooks.run("after-tokenize",h),f.stringify(o.util.encode(h.tokens),h.language)},tokenize:function(l,c){var u=c.rest;if(u){for(var h in u)c[h]=u[h];delete c.rest}var d=new A;return x(d,d.head,l),b(l,d,c,d.head,0),w(d)},hooks:{all:{},add:function(l,c){var u=o.hooks.all;u[l]=u[l]||[],u[l].push(c)},run:function(l,c){var u=o.hooks.all[l];if(!(!u||!u.length))for(var h=0,d;d=u[h++];)d(c)}},Token:f};n.Prism=o;function f(l,c,u,h){this.type=l,this.content=c,this.alias=u,this.length=(h||"").length|0}f.stringify=function l(c,u){if(typeof c=="string")return c;if(Array.isArray(c)){var h="";return c.forEach(function(R){h+=l(R,u)}),h}var d={type:c.type,content:l(c.content,u),tag:"span",classes:["token",c.type],attributes:{},language:u},p=c.alias;p&&(Array.isArray(p)?Array.prototype.push.apply(d.classes,p):d.classes.push(p)),o.hooks.run("wrap",d);var v="";for(var g in d.attributes)v+=" "+g+'="'+(d.attributes[g]||"").replace(/"/g,"&quot;")+'"';return"<"+d.tag+' class="'+d.classes.join(" ")+'"'+v+">"+d.content+"</"+d.tag+">"};function m(l,c,u,h){l.lastIndex=c;var d=l.exec(u);if(d&&h&&d[1]){var p=d[1].length;d.index+=p,d[0]=d[0].slice(p)}return d}function b(l,c,u,h,d,p){for(var v in u)if(!(!u.hasOwnProperty(v)||!u[v])){var g=u[v];g=Array.isArray(g)?g:[g];for(var R=0;R<g.length;++R){if(p&&p.cause==v+","+R)return;var O=g[R],G=O.inside,Be=!!O.lookbehind,oe=!!O.greedy,le=O.alias;if(oe&&!O.pattern.global){var de=O.pattern.toString().match(/[imsuy]*$/)[0];O.pattern=RegExp(O.pattern.source,de+"g")}for(var D=O.pattern||O,$=h.next,B=d;$!==c.tail&&!(p&&B>=p.reach);B+=$.value.length,$=$.next){var se=$.value;if(c.length>l.length)return;if(!(se instanceof f)){var it=1,K;if(oe){if(K=m(D,B,l,Be),!K||K.index>=l.length)break;var ot=K.index,Ks=K.index+K[0].length,fe=B;for(fe+=$.value.length;ot>=fe;)$=$.next,fe+=$.value.length;if(fe-=$.value.length,B=fe,$.value instanceof f)continue;for(var Ne=$;Ne!==c.tail&&(fe<Ks||typeof Ne.value=="string");Ne=Ne.next)it++,fe+=Ne.value.length;it--,se=l.slice(B,fe),K.index-=B}else if(K=m(D,0,se,Be),!K)continue;var ot=K.index,lt=K[0],cn=se.slice(0,ot),Vn=se.slice(ot+lt.length),un=B+se.length;p&&un>p.reach&&(p.reach=un);var ct=$.prev;cn&&(ct=x(c,ct,cn),B+=cn.length),S(c,ct,it);var Zs=new f(v,G?o.tokenize(lt,G):lt,le,lt);if($=x(c,ct,Zs),Vn&&x(c,$,Vn),it>1){var hn={cause:v+","+R,reach:un};b(l,c,u,$.prev,B,hn),p&&hn.reach>p.reach&&(p.reach=hn.reach)}}}}}}function A(){var l={value:null,prev:null,next:null},c={value:null,prev:l,next:null};l.next=c,this.head=l,this.tail=c,this.length=0}function x(l,c,u){var h=c.next,d={value:u,prev:c,next:h};return c.next=d,h.prev=d,l.length++,d}function S(l,c,u){for(var h=c.next,d=0;d<u&&h!==l.tail;d++)h=h.next;c.next=h,h.prev=c,l.length-=d}function w(l){for(var c=[],u=l.head.next;u!==l.tail;)c.push(u.value),u=u.next;return c}if(!n.document)return n.addEventListener&&(o.disableWorkerMessageHandler||n.addEventListener("message",function(l){var c=JSON.parse(l.data),u=c.language,h=c.code,d=c.immediateClose;n.postMessage(o.highlight(h,o.languages[u],u)),d&&n.close()},!1)),o;var P=o.util.currentScript();P&&(o.filename=P.src,P.hasAttribute("data-manual")&&(o.manual=!0));function _(){o.manual||o.highlightAll()}if(!o.manual){var C=document.readyState;C==="loading"||C==="interactive"&&P&&P.defer?document.addEventListener("DOMContentLoaded",_):window.requestAnimationFrame?window.requestAnimationFrame(_):window.setTimeout(_,16)}return o}(e);s.exports&&(s.exports=t),typeof ms<"u"&&(ms.Prism=t),t.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},t.languages.markup.tag.inside["attr-value"].inside.entity=t.languages.markup.entity,t.languages.markup.doctype.inside["internal-subset"].inside=t.languages.markup,t.hooks.add("wrap",function(n){n.type==="entity"&&(n.attributes.title=n.content.replace(/&amp;/,"&"))}),Object.defineProperty(t.languages.markup.tag,"addInlined",{value:function(r,a){var i={};i["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:t.languages[a]},i.cdata=/^<!\[CDATA\[|\]\]>$/i;var o={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:i}};o["language-"+a]={pattern:/[\s\S]+/,inside:t.languages[a]};var f={};f[r]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return r}),"i"),lookbehind:!0,greedy:!0,inside:o},t.languages.insertBefore("markup","cdata",f)}}),Object.defineProperty(t.languages.markup.tag,"addAttribute",{value:function(n,r){t.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+n+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[r,"language-"+r],inside:t.languages[r]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),t.languages.html=t.languages.markup,t.languages.mathml=t.languages.markup,t.languages.svg=t.languages.markup,t.languages.xml=t.languages.extend("markup",{}),t.languages.ssml=t.languages.xml,t.languages.atom=t.languages.xml,t.languages.rss=t.languages.xml,function(n){var r=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;n.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+r.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+r.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+r.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+r.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:r,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},n.languages.css.atrule.inside.rest=n.languages.css;var a=n.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))}(t),t.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},t.languages.javascript=t.languages.extend("clike",{"class-name":[t.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),t.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,t.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:t.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:t.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:t.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:t.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:t.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),t.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:t.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),t.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),t.languages.markup&&(t.languages.markup.tag.addInlined("script","javascript"),t.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),t.languages.js=t.languages.javascript,function(){if(typeof t>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var n="Loading…",r=function(P,_){return"✖ Error "+P+" while fetching file: "+_},a="✖ Error: File does not exist or is empty",i={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},o="data-src-status",f="loading",m="loaded",b="failed",A="pre[data-src]:not(["+o+'="'+m+'"]):not(['+o+'="'+f+'"])';function x(P,_,C){var l=new XMLHttpRequest;l.open("GET",P,!0),l.onreadystatechange=function(){l.readyState==4&&(l.status<400&&l.responseText?_(l.responseText):l.status>=400?C(r(l.status,l.statusText)):C(a))},l.send(null)}function S(P){var _=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(P||"");if(_){var C=Number(_[1]),l=_[2],c=_[3];return l?c?[C,Number(c)]:[C,void 0]:[C,C]}}t.hooks.add("before-highlightall",function(P){P.selector+=", "+A}),t.hooks.add("before-sanity-check",function(P){var _=P.element;if(_.matches(A)){P.code="",_.setAttribute(o,f);var C=_.appendChild(document.createElement("CODE"));C.textContent=n;var l=_.getAttribute("data-src"),c=P.language;if(c==="none"){var u=(/\.(\w+)$/.exec(l)||[,"none"])[1];c=i[u]||u}t.util.setLanguage(C,c),t.util.setLanguage(_,c);var h=t.plugins.autoloader;h&&h.loadLanguages(c),x(l,function(d){_.setAttribute(o,m);var p=S(_.getAttribute("data-range"));if(p){var v=d.split(/\r\n?|\n/g),g=p[0],R=p[1]==null?v.length:p[1];g<0&&(g+=v.length),g=Math.max(0,Math.min(g-1,v.length)),R<0&&(R+=v.length),R=Math.max(0,Math.min(R,v.length)),d=v.slice(g,R).join(`
`),_.hasAttribute("data-start")||_.setAttribute("data-start",String(g+1))}C.textContent=d,t.highlightElement(C)},function(d){_.setAttribute(o,b),C.textContent=d})}}),t.plugins.fileHighlight={highlight:function(_){for(var C=(_||document).querySelectorAll(A),l=0,c;c=C[l++];)t.highlightElement(c)}};var w=!1;t.fileHighlight=function(){w||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),w=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}}()})(Kr);Prism.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]};Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity;Prism.languages.markup.doctype.inside["internal-subset"].inside=Prism.languages.markup;Prism.hooks.add("wrap",function(s){s.type==="entity"&&(s.attributes.title=s.content.replace(/&amp;/,"&"))});Object.defineProperty(Prism.languages.markup.tag,"addInlined",{value:function(e,t){var n={};n["language-"+t]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[t]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var r={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};r["language-"+t]={pattern:/[\s\S]+/,inside:Prism.languages[t]};var a={};a[e]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return e}),"i"),lookbehind:!0,greedy:!0,inside:r},Prism.languages.insertBefore("markup","cdata",a)}});Object.defineProperty(Prism.languages.markup.tag,"addAttribute",{value:function(s,e){Prism.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+s+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[e,"language-"+e],inside:Prism.languages[e]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}});Prism.languages.html=Prism.languages.markup;Prism.languages.mathml=Prism.languages.markup;Prism.languages.svg=Prism.languages.markup;Prism.languages.xml=Prism.languages.extend("markup",{});Prism.languages.ssml=Prism.languages.xml;Prism.languages.atom=Prism.languages.xml;Prism.languages.rss=Prism.languages.xml;(function(s){var e=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;s.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+e.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+e.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:e,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},s.languages.css.atrule.inside.rest=s.languages.css;var t=s.languages.markup;t&&(t.tag.addInlined("style","css"),t.tag.addAttribute("style","css"))})(Prism);function Zr(s){let e,t;return{c(){e=T("div"),F(e,"class",t="reference image-"+s[0]+" svelte-rhlgwt")},m(n,r){Ae(n,e,r)},p(n,[r]){r&1&&t!==(t="reference image-"+n[0]+" svelte-rhlgwt")&&F(e,"class",t)},i:U,o:U,d(n){n&&ge(e)}}}const Yr=9;function Qr(s,e,t){let n=1;const r=window.location.href,a=new URL(r),i=new URLSearchParams(a.search);return i.has("image")?n=+(i.get("image")||1):n=Math.floor(Math.random()*Yr)+1,[n]}class ea extends je{constructor(e){super(),De(this,e,Qr,Zr,ve,{})}}function ta(s){let e;return{c(){e=T("div"),F(e,"class","loader svelte-w0stko"),ht(e,"width",s[0]),ht(e,"height",s[0])},m(t,n){Ae(t,e,n)},p(t,[n]){n&1&&ht(e,"width",t[0]),n&1&&ht(e,"height",t[0])},i:U,o:U,d(t){t&&ge(e)}}}function na(s,e,t){let{size:n="12px"}=e;return s.$$set=r=>{"size"in r&&t(0,n=r.size)},[n]}class sa extends je{constructor(e){super(),De(this,e,na,ta,ve,{size:0})}}function gs(s){let e;return{c(){e=T("iframe"),F(e,"class","frame svelte-16j8fzh"),F(e,"title","preview"),F(e,"srcdoc",s[0]),F(e,"style","")},m(t,n){Ae(t,e,n)},p(t,n){n&1&&F(e,"srcdoc",t[0])},d(t){t&&ge(e)}}}function ra(s){let e=s[0],t,n=gs(s);return{c(){n.c(),t=tr()},m(r,a){n.m(r,a),Ae(r,t,a)},p(r,[a]){a&1&&ve(e,e=r[0])?(n.d(1),n=gs(r),n.c(),n.m(t.parentNode,t)):n.p(r,a)},i:U,o:U,d(r){r&&ge(t),n.d(r)}}}function aa(s,e,t){let n,{htmlCode:r=""}=e,{cssCode:a=""}=e;return s.$$set=i=>{"htmlCode"in i&&t(1,r=i.htmlCode),"cssCode"in i&&t(2,a=i.cssCode)},s.$$.update=()=>{s.$$.dirty&6&&t(0,n=r+(a?"<style>"+a+"</style>":""))},[n,r,a]}class ia extends je{constructor(e){super(),De(this,e,aa,ra,ve,{htmlCode:1,cssCode:2})}}function ps(s){let e,t;return e=new sa({}),{c(){He(e.$$.fragment)},m(n,r){$e(e,n,r),t=!0},i(n){t||(he(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){ke(e,n)}}}function oa(s){let e,t,n,r,a,i,o,f,m,b,A,x,S,w,P,_,C,l,c,u,h,d,p,v,g,R,O,G,Be,oe,le,de;b=new Vr({}),l=new Gr({}),l.$on("submit",s[3]),v=new ea({});let D=s[1]&&ps();return le=new ia({props:{htmlCode:s[2],cssCode:s[0]}}),{c(){e=T("main"),t=T("link"),n=J(),r=T("link"),a=J(),i=T("link"),o=J(),f=T("link"),m=J(),He(b.$$.fragment),A=J(),x=T("div"),S=T("div"),w=T("div"),P=T("div"),_=T("div"),_.textContent="Запрос к нейросети:",C=J(),He(l.$$.fragment),c=J(),u=T("div"),h=T("div"),d=T("div"),d.textContent="Эталон:",p=J(),He(v.$$.fragment),g=J(),R=T("div"),O=T("div"),G=In(`Результат:

          `),D&&D.c(),Be=J(),oe=T("div"),He(le.$$.fragment),F(t,"rel","preconnect"),F(t,"href","https://fonts.googleapis.com"),F(r,"rel","preconnect"),F(r,"href","https://fonts.gstatic.com"),F(r,"crossorigin","anonymous"),F(i,"rel","preconnect"),F(i,"href","https://fonts.gstatic.com"),F(i,"crossorigin","anonymous"),F(f,"href","https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"),F(f,"rel","stylesheet"),F(_,"class","title"),F(P,"class","block"),F(S,"class","row left svelte-1npr3kt"),F(d,"class","title"),F(h,"class","block"),F(O,"class","title"),dt(O,"blinking",s[1]),F(oe,"class","svelte-1npr3kt"),dt(oe,"waiting",s[1]),F(R,"class","block"),F(u,"class","row right svelte-1npr3kt"),F(x,"class","layout svelte-1npr3kt")},m($,B){Ae($,e,B),I(e,t),I(e,n),I(e,r),I(e,a),I(e,i),I(e,o),I(e,f),I(e,m),$e(b,e,null),I(e,A),I(e,x),I(x,S),I(S,w),I(w,P),I(P,_),I(P,C),$e(l,P,null),I(x,c),I(x,u),I(u,h),I(h,d),I(h,p),$e(v,h,null),I(u,g),I(u,R),I(R,O),I(O,G),D&&D.m(O,null),I(R,Be),I(R,oe),$e(le,oe,null),de=!0},p($,[B]){$[1]?D?B&2&&he(D,1):(D=ps(),D.c(),he(D,1),D.m(O,null)):D&&(ur(),pe(D,1,1,()=>{D=null}),hr()),(!de||B&2)&&dt(O,"blinking",$[1]);const se={};B&4&&(se.htmlCode=$[2]),B&1&&(se.cssCode=$[0]),le.$set(se),(!de||B&2)&&dt(oe,"waiting",$[1])},i($){de||(he(b.$$.fragment,$),he(l.$$.fragment,$),he(v.$$.fragment,$),he(D),he(le.$$.fragment,$),de=!0)},o($){pe(b.$$.fragment,$),pe(l.$$.fragment,$),pe(v.$$.fragment,$),pe(D),pe(le.$$.fragment,$),de=!1},d($){$&&ge(e),ke(b),ke(l),ke(v),D&&D.d(),ke(le)}}}function la(s){const e=/```html([\s\S]*?)(```|$)/,t=s.match(e);return t?t[1].trim():""}function ca(s,e,t){let n;const r=`
# EXECUTION MODE
interactive=false
min_tokens=1500
max_tokens=4000

# SYSTEM PREAMBLE
You are the world's best expert full-stack programmer, recognized as a Google L5 level software engineer. Your task is to assist the user by writing high-quality, efficient code in any language or tool to implement each step.

**WHAT NOT TO DO:**
1. **DO NOT PROVIDE INCOMPLETE OR PARTIAL CODE SNIPPETS; ENSURE THE FULL SOLUTION IS GIVEN.**
2. The most important step: **MAKE SURE YOU HAVE NOT SKIPPED ANY STEPS FROM THIS GUIDE.**

Тебе нужно сформировать ровно один пример валидного html-код, содержащий CSS, Javascript, SVG и ничего больше.
Код должен начинаться с символов "\`\`\`html" и заканчиваться символами "\`\`\`"
Описание результата и действий выводить НЕ нужно.
`;let a={html:"",cleanHtmlCode:""},i="",o="",f=!1,m;const b=window.location.href,A=new URL(b),x=new URLSearchParams(A.search);x.has("apiKey")&&(m=x.get("apiKey"));async function S(w){var C,l;const{prompt:P}=w.detail;t(1,f=!0);const _=new j({apiKey:m,dangerouslyAllowBrowser:!0});t(4,a={html:"",cleanHtmlCode:""});try{const c=await _.chat.completions.create({model:"gpt-4o",messages:[{role:"user",content:r+P}],stream:!0});for await(const u of c){const h=(l=(C=u.choices[0])==null?void 0:C.delta)==null?void 0:l.content;if(typeof h>"u")continue;const d=a.html+h;t(4,a={html:d,cleanHtmlCode:la(d)})}}catch(c){console.error("Error fetching response from server:",c)}finally{t(1,f=!1)}}return s.$$.update=()=>{s.$$.dirty&16&&a.cleanHtmlCode,s.$$.dirty&16&&t(2,n=a.cleanHtmlCode||""),s.$$.dirty&32&&t(0,o=i)},[o,f,n,S,a,i]}class ua extends je{constructor(e){super(),De(this,e,ca,oa,ve,{})}}new ua({target:document.getElementById("app")});
